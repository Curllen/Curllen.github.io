<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Curllen`Blog</title>
    <link>http://curllen.uicp.io/</link>
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>一枚程序员的博客</description>
    <pubDate>Wed, 31 Oct 2018 07:14:17 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>mybatis系列(四):maybatis强大特性之resultMap</title>
      <link>http://curllen.uicp.io/2018/10/31/mybatis%E4%B9%8BresultMap/</link>
      <guid>http://curllen.uicp.io/2018/10/31/mybatis%E4%B9%8BresultMap/</guid>
      <pubDate>Wed, 31 Oct 2018 07:12:49 GMT</pubDate>
      <description>
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;位于sql语句所在的映射文件中(也可以抽取为一个单独的映射文件),mybatis最强大的功能, 多用于多表查询的情景&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;解决两大问题&quot;&gt;&lt;a href=&quot;#解决两大问题&quot; class=&quot;header
        
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>位于sql语句所在的映射文件中(也可以抽取为一个单独的映射文件),mybatis最强大的功能, 多用于多表查询的情景</p></blockquote><h2 id="解决两大问题"><a href="#解决两大问题" class="headerlink" title="解决两大问题"></a>解决两大问题</h2><ul><li>POJO属性名和表结构字段名不一致的问题(有些情况下也不是驼峰格式)</li><li>完成高级查询,包括但是不限于: 一对一、一对多、多对多.<blockquote><p>在映射文件中定义</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- resultMap:自定义映射关系</span><br><span class="line">属性：type-结果集的封装类型，id-唯一标识，autoMapping-开启自动匹配，如果开启了驼峰匹配，就以驼峰匹配的形式进行匹配</span><br><span class="line">id:指定主键映射的，不要省。提高性能</span><br><span class="line">result：其他的非主键普通字段</span><br><span class="line">子标签的属性：Column-表中的字段名，property-对应的java属性名</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;resultMap type=&quot;User&quot; id=&quot;userMap&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;!-- 数据库表的主键uid映射id, 即使相同也不要省,提高性能 --&gt;</span><br><span class="line">&lt;id column=&quot;uid&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;!-- 数据库表的普通字段user_name映射userName --&gt;</span><br><span class="line">&lt;result column=&quot;user_name&quot; property=&quot;userName&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><p><em>自定义resultMap中，主键需要通过id子标签配置，表字段和属性名不一致的普通字段需要通过result子标签配置。<br>那么，字段名称匹配的字段要不要配置那？<br>这个取决于resultMap中的autoMapping属性的值：<br>为true时：resultMap中的没有配置的字段会自动对应。<br>为false时：只针对resultMap中已经配置的字段作映射。<br>并且resultMap会自动映射单表查询的结果集（结果是个集合，自定义resultMap,其type=”实体类”, 集合里存储的是pojo, 故一般而言，任何的select语句都可以使用map存储）。</em></p><blockquote><p>在映射文件中的使用</p></blockquote><p>在select等标签中,通过rsultMap=”自定义的resultMap的id名”来使用</p><h2 id="resulttMap其他参数解析"><a href="#resulttMap其他参数解析" class="headerlink" title="resulttMap其他参数解析"></a>resulttMap其他参数解析</h2><blockquote><p>所有参数</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap&gt;</span><br><span class="line">      &lt;constructor&gt;</span><br><span class="line">         &lt;idArg/&gt;</span><br><span class="line">         &lt;arg/&gt;</span><br><span class="line">      &lt;/constructor&gt;</span><br><span class="line">      &lt;id/&gt;</span><br><span class="line">      &lt;result/&gt;</span><br><span class="line">      &lt;association/&gt;</span><br><span class="line">      &lt;collection/&gt;</span><br><span class="line">      &lt;discriminator &gt;</span><br><span class="line">          &lt;case/&gt;</span><br><span class="line">      &lt;/discriminator&gt;</span><br><span class="line">   &lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><ul><li>constructor元素<blockquote><p>用于配置构造方法。一个pojo可能不存在没有参数的构造方法，则使用constructor进行配置。假设RoleBean不存在没有参数的构造方法，它的构造方法声明为public Role(Integer id,String roleName)</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap ...&gt;</span><br><span class="line">      &lt;constructor&gt;</span><br><span class="line">         &lt;idArg column=&quot;id&quot; javaType=&quot;int&quot;/&gt;</span><br><span class="line">         &lt;arg column=&quot;role_name&quot; javaType=&quot;string&quot;/&gt;</span><br><span class="line">      &lt;/constructor&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><ul><li>mybatis中级联(高级查询)分为这么三种：association，collection和discriminator<ul><li>association：代表一对一关系,作用: 将关联查询信息映射到一个pojo类中</li><li>collection：代表一对多关系,作用: 将关联查询信息映射到一个list集合中</li><li>discriminator：鉴别器，它可以根据实际选择采用哪个类作为实例，允许根据特定的条件去关联不同的结果集。比如，人有男人和女人，可以实例化一个对象，但是根据情况用男人类或者女人类去实例化<blockquote><p>association<br>实体类</p></blockquote></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Order implements Serializable &#123;</span><br><span class="line">  private Integer id;</span><br><span class="line"></span><br><span class="line">  private Long userId;</span><br><span class="line"></span><br><span class="line">  private String orderNumber;</span><br><span class="line">  </span><br><span class="line">  //关联用户信息</span><br><span class="line">  private User user;</span><br><span class="line">    </span><br><span class="line">  //订单明细</span><br><span class="line">  private List&lt;Orderdetail&gt; orderdetails;</span><br><span class="line"> ...省略get/set方法...</span><br></pre></td></tr></table></figure><blockquote><p>SQL语句所在映射文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;Order&quot; id=&quot;orderUserMap&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">association:一对一的映射</span><br><span class="line">property：java的属性名</span><br><span class="line">javaType：属性名对应的java类型</span><br><span class="line">autoMapping:开启自动映射</span><br><span class="line">子标签：参照resultMap</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;association property=&quot;user&quot; javaType=&quot;User&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;id column=&quot;user_id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;/association&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- resultType不能完成user信息的映射，必须使用resultMap，resultMap的值对应resultMap标签的id，resultMap和resultType必须二选一 --&gt;</span><br><span class="line">&lt;select id=&quot;queryOrderWithUser&quot; resultMap=&quot;orderUserMap&quot;&gt;</span><br><span class="line">select * from tb_order a </span><br><span class="line">LEFT JOIN tb_user b on a.user_id=b.id</span><br><span class="line">where a.order_number = #&#123;number&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>collection(例1把resultMap抽取为一个单独的映射文件)</p><ul><li>例1:<br>实体类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Orders implements Serializable &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    private Integer userId;</span><br><span class="line"></span><br><span class="line">    private String number;</span><br><span class="line"></span><br><span class="line">    private Date createtime;</span><br><span class="line"></span><br><span class="line">    private String note;</span><br><span class="line">    </span><br><span class="line">    //关联用户信息</span><br><span class="line">    private User user;</span><br><span class="line">    </span><br><span class="line">    //订单明细</span><br><span class="line">    private List&lt;Orderdetail&gt; orderdetails;</span><br><span class="line">    ...省略get/set方法...</span><br></pre></td></tr></table></figure></li></ul></blockquote><blockquote><p>抽取出来的单独映射文件</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 一对多，查询订单及订单明细 --&gt;</span><br><span class="line">&lt;resultMap type=&quot;orders&quot; id=&quot;orderAndOrderDetails&quot; extends=&quot;ordersUserResultMap&quot;&gt;</span><br><span class="line">&lt;!-- 映射订单信息，和用户信息，这里使用继承ordersUserResultMap --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 映射订单明细信息 </span><br><span class="line">property：要将关联信息映射到orders的哪个属性中</span><br><span class="line">ofType：集合中pojo的类型</span><br><span class="line">--&gt;</span><br><span class="line">&lt;collection property=&quot;orderdetails&quot; ofType=&quot;cn.itcast.mybatis.po.Orderdetail&quot;&gt;</span><br><span class="line">&lt;!-- id：关联信息订单明细的唯 一标识</span><br><span class="line">property：Orderdetail的属性名</span><br><span class="line">  --&gt;</span><br><span class="line">&lt;id column=&quot;orderdetail_id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;result column=&quot;items_num&quot; property=&quot;itemsNum&quot;/&gt;</span><br><span class="line">&lt;result column=&quot;items_id&quot; property=&quot;itemsId&quot;/&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line"></span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><ul><li>例2<blockquote><p>实体类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Order implements Serializable &#123;</span><br><span class="line">  private Integer id;</span><br><span class="line"></span><br><span class="line">  private Long userId;</span><br><span class="line"></span><br><span class="line">  private String orderNumber;</span><br><span class="line">  </span><br><span class="line">  //关联用户信息</span><br><span class="line">  private User user;</span><br><span class="line">    </span><br><span class="line">  //订单明细</span><br><span class="line">  private List&lt;Orderdetail&gt; orderdetails;</span><br><span class="line"> ...省略get/set方法...</span><br></pre></td></tr></table></figure></blockquote></li></ul><blockquote><p>SQL语句所在映射文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;Order&quot; id=&quot;orderUserDetailMap&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;association property=&quot;user&quot; javaType=&quot;User&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;id column=&quot;user_id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;/association&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">collection:一对多的查询</span><br><span class="line">property:属性名</span><br><span class="line">javaType：集合类型(可以省略?)</span><br><span class="line">ofType：集合中的元素类型</span><br><span class="line">autoMapping：开启自动映射</span><br><span class="line">子标签：参照resultMap</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;collection property=&quot;detailList&quot; javaType=&quot;list&quot; ofType=&quot;Orderdetail&quot; autoMapping=&quot;true&quot;&gt;</span><br><span class="line">&lt;id column=&quot;detail_id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;queryOrderWithUserDetail&quot; resultMap=&quot;orderUserDetailMap&quot;&gt;</span><br><span class="line">select *,c.id as detail_id from tb_order a</span><br><span class="line">LEFT JOIN tb_user b on a.user_id=b.id</span><br><span class="line">LEFT JOIN tb_orderdetail c on a.id=c.order_id</span><br><span class="line">where a.order_number=#&#123;number&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content:encoded>
      
      <comments>http://curllen.uicp.io/2018/10/31/mybatis%E4%B9%8BresultMap/#disqus_thread</comments>
    </item>
    
    <item>
      <title>mybatis系列(三):抽取SQL片段-优化SQL</title>
      <link>http://curllen.uicp.io/2018/10/31/mybatis%E6%8A%BD%E5%8F%96SQL%E7%89%87%E6%AE%B5/</link>
      <guid>http://curllen.uicp.io/2018/10/31/mybatis%E6%8A%BD%E5%8F%96SQL%E7%89%87%E6%AE%B5/</guid>
      <pubDate>Wed, 31 Oct 2018 07:02:00 GMT</pubDate>
      <description>
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;如果某些sql片段在多个sql语句中被复用,可以将这些sql片段抽取为一个单独的映射文件(例如SQL语句中*,都尽可能用具体的字段名代替,以提高执行效率,这个过程中会出现大量重复sql片段).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;抽
        
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>如果某些sql片段在多个sql语句中被复用,可以将这些sql片段抽取为一个单独的映射文件(例如SQL语句中*,都尽可能用具体的字段名代替,以提高执行效率,这个过程中会出现大量重复sql片段).</p></blockquote><h2 id="抽取片段"><a href="#抽取片段" class="headerlink" title="抽取片段"></a>抽取片段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 为何要抽取以下片段,去除SQL语句中的*,可以提高执行效率 --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;!-- namespace(命名空间)：映射文件的唯一标识 --&gt;</span><br><span class="line">&lt;mapper namespace=&quot;CommonSQL&quot;&gt;</span><br><span class="line">    &lt;!-- 通过sql标签&gt;id唯一标识片段 --&gt;</span><br><span class="line">&lt;sql id=&quot;commonSql&quot;&gt;</span><br><span class="line">id,user_name,</span><br><span class="line">password,</span><br><span class="line">name,</span><br><span class="line">age,</span><br><span class="line">sex,</span><br><span class="line">birthday,</span><br><span class="line">created,</span><br><span class="line">updated</span><br><span class="line">&lt;/sql&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><h2 id="引用片段"><a href="#引用片段" class="headerlink" title="引用片段"></a>引用片段</h2><ul><li>mybatis-config.xml</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;CommonSQL.xml&quot;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><ul><li>需要使用片段的映射文件:在需要使用该sql片段的地方通过include标签的refid属性引用该sql片段：<include refid="”名称空间.sql片段的id”"></include></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &lt;sql id=&quot;commonSql&quot;&gt;</span><br><span class="line">id,user_name,</span><br><span class="line">password,</span><br><span class="line">name,</span><br><span class="line">age,</span><br><span class="line">sex,</span><br><span class="line">birthday,</span><br><span class="line">created,</span><br><span class="line">updated</span><br><span class="line">&lt;/sql&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;queryUsersLikeUserName&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">select &lt;include refid=&quot;CommonSQL.commonSql&quot;&gt;&lt;/include&gt; from tb_user where user_name like &apos;%&apos; #&#123;userName&#125; &apos;%&apos;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://curllen.uicp.io/2018/10/31/mybatis%E6%8A%BD%E5%8F%96SQL%E7%89%87%E6%AE%B5/#disqus_thread</comments>
    </item>
    
    <item>
      <title>mybatis系列(二):mybatis动态SQL</title>
      <link>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81SQL/</link>
      <guid>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81SQL/</guid>
      <pubDate>Wed, 31 Oct 2018 06:57:42 GMT</pubDate>
      <description>
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;位于映射文件中,提供OGNL表达式动态生成SQL的功能.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;动态SQL&quot;&gt;&lt;a href=&quot;#动态SQL&quot; class=&quot;headerlink&quot; title=&quot;动态SQL&quot;&gt;&lt;/a&gt;动态SQL&lt;/h
        
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>位于映射文件中,提供OGNL表达式动态生成SQL的功能.</p></blockquote><h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><ul><li>if<blockquote><p>判断语句, 例如判断是否输入用户名来拼接语句</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserListLikeUserName&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">select * from tb_user where sex=1</span><br><span class="line">&lt;!-- if:判断</span><br><span class="line">test：OGNL表达式</span><br><span class="line">userName:接口文件中通过@param设定的参数名(下同)</span><br><span class="line">trim:字符串处理方法,去掉字符串起始和结尾的空格(JQuery也有相同方法)</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;if test=&quot;userName!=null and userName.trim()!=&apos;&apos;&quot;&gt;</span><br><span class="line"> and user_name like &apos;%&apos; #&#123;userName&#125; &apos;%&apos;</span><br><span class="line">&lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>choose&gt;when,otherwise(&gt;,表示标签级别,&gt;前面是父标签)<blockquote><p>条件选择,例如是否输入用户名/年龄来拼接语句(选其一,只选择第一个符合条件(或都不符合情况下的otherwise)的语句进行拼接)</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserListLikeUserNameOrAge&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">select * from tb_user where sex=1 </span><br><span class="line">&lt;!-- choose:条件选择</span><br><span class="line">when：test-判断条件，一旦有一个when成立，后续的when都不再执行</span><br><span class="line">otherwise：所有的when都不成立时，才会执行</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;choose&gt;</span><br><span class="line">&lt;when test=&quot;userName!=null and userName.trim()!=&apos;&apos;&quot;&gt;and user_name like &apos;%&apos; #&#123;userName&#125; &apos;%&apos;&lt;/when&gt;</span><br><span class="line">&lt;when test=&quot;age != null&quot;&gt;and age = #&#123;age&#125;&lt;/when&gt;</span><br><span class="line">&lt;otherwise&gt;and user_name = &apos;zhangsan&apos; &lt;/otherwise&gt;</span><br><span class="line">&lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>where<blockquote><p>条件选择,和if/choose配合使用,给sql拼接多个语句, 例如即输入了用户名也输入了年龄,全部拼接进SQL语句</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserListLikeUserNameAndAge&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">select * from tb_user</span><br><span class="line">&lt;!-- </span><br><span class="line">会在SQL语句中自动添加where关键字</span><br><span class="line">有一定的纠错功能：去掉sql语句块之前多余的一个and|or</span><br><span class="line">通常结合if或者choose使用</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;where&gt;</span><br><span class="line">&lt;if test=&quot;userName!=null and userName.trim()!=&apos;&apos;&quot;&gt;user_name like &apos;%&apos; #&#123;userName&#125; &apos;%&apos;&lt;/if&gt;</span><br><span class="line">&lt;if test=&quot;age!=null&quot;&gt;and age = #&#123;age&#125;&lt;/if&gt;</span><br><span class="line">&lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>set<blockquote><p>更新信息,和if配合使用,当其中某个if不满足,则数据库不更新该字段,例如更新用户信息,sex=null</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateUserSelective&quot; &gt;</span><br><span class="line">UPDATE tb_user</span><br><span class="line">&lt;!-- </span><br><span class="line">会在SQL语句中自动添加set关键字</span><br><span class="line">也有一定的纠错功能：自动去掉sql语句块之后多余的一个逗号</span><br><span class="line">有关sex的if不通过,则数据库不更新sex的值</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;set&gt;</span><br><span class="line">&lt;if test=&quot;userName!=null and userName.trim()!=&apos;&apos;&quot;&gt;user_name = #&#123;userName&#125;,&lt;/if&gt;</span><br><span class="line">&lt;if test=&quot;password!=null and password.trim()!=&apos;&apos;&quot;&gt;password = #&#123;password&#125;,&lt;/if&gt;</span><br><span class="line">&lt;if test=&quot;name!=null and name.trim()!=&apos;&apos;&quot;&gt;name = #&#123;name&#125;,&lt;/if&gt;</span><br><span class="line">&lt;if test=&quot;age!=null&quot;&gt;age = #&#123;age&#125;,&lt;/if&gt;</span><br><span class="line">&lt;if test=&quot;sex!=null&quot;&gt;sex = #&#123;sex&#125;,&lt;/if&gt;</span><br><span class="line">updated = now(),</span><br><span class="line">&lt;/set&gt;</span><br><span class="line">WHERE</span><br><span class="line">(id = #&#123;id&#125;);</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure><ul><li>foreach<blockquote><p>当参数是集合/数组(集合底层是可变数组),进行遍历(突破参数只能是基本数据类型,HashMap,pojo)</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;queryUserListByIds&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">select * from tb_user where id in </span><br><span class="line">&lt;!-- </span><br><span class="line">foreach:遍历集合</span><br><span class="line">collection：接收的集合参数,接口文件中通过@param设定的参数名</span><br><span class="line">item：被遍历的集合中的一个元素</span><br><span class="line">separator:分隔符</span><br><span class="line">open:以什么开始(本例中,如果foreach已经被了&apos;()&apos;包围,则不用open和close</span><br><span class="line">close：以什么结束</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;foreach collection=&quot;ids&quot; item=&quot;id&quot; separator=&quot;,&quot; open=&quot;(&quot; close=&quot;)&quot;&gt;</span><br><span class="line">#&#123;id&#125;</span><br><span class="line">&lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81SQL/#disqus_thread</comments>
    </item>
    
    <item>
      <title>mybatis系列(一):mybatis动态代理</title>
      <link>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</link>
      <guid>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</guid>
      <pubDate>Wed, 31 Oct 2018 06:46:09 GMT</pubDate>
      <description>
      
        
        
          &lt;blockquote&gt;
&lt;p&gt;映射文件的配置参数中:parameterType参数都可以不写&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;默认规则&quot;&gt;&lt;a href=&quot;#默认规则&quot; class=&quot;headerlink&quot; title=&quot;默认规则&quot;&gt;&lt;/a&gt;默认规则&lt;/h2
        
      
      </description>
      
      <content:encoded><![CDATA[<blockquote><p>映射文件的配置参数中:parameterType参数都可以不写</p></blockquote><h2 id="默认规则"><a href="#默认规则" class="headerlink" title="默认规则"></a>默认规则</h2><ul><li>dao接口名称通常命名为XxxMapper.</li><li>映射文件:Xxxmapper.xml, statementid与接口的方法名保持一致.<h2 id="mybatis-config-xml配置-以下按该顺序写"><a href="#mybatis-config-xml配置-以下按该顺序写" class="headerlink" title="mybatis-config.xml配置(以下按该顺序写)"></a>mybatis-config.xml配置(以下按该顺序写)</h2></li></ul><ol><li>导入jdbc配置文件(使用$):<blockquote><p><code>&lt;properties resource=&quot;jdbc.properties&quot;&gt;&lt;/properties&gt;</code></p></blockquote></li><li>开启驼峰匹配：经典的数据库列名（多个单词下划线连接）映射到经典的java属性名(多个单词驼峰连接)<blockquote><p><code>&lt;settings&gt;&lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;&lt;/settings&gt;</code></p></blockquote></li><li>在映射文件中的参数使用别名(就可不用全路径,但开启了也可以全路径),方式2种,只写一种<blockquote><p><code>&lt;typeAliases&gt;</code><br><br><code>//自动将类名转换为别名,大小写不敏感</code><br><br><code>&lt;package name=&quot;包名&quot;&gt;</code><br><br><code>&lt;/typeAliases&gt;</code></p></blockquote></li><li>environments,可以配置多个environment(环境),选中环境的方式<blockquote><p>①<code>&lt;environments default=&quot;环境id名&quot;&gt;...&lt;environments&gt;</code></p></blockquote></li></ol><blockquote><p>②<code>SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader,&quot;环境id名&quot;);</code></p><ol start="5"><li>映入映射文件4种,只写一种<br><code>&lt;mappers&gt;</code><br><br><code>&lt;mapper resource=&quot;映射文件名&quot;&gt;</code><br><br><code>&lt;/mappers&gt;</code></li></ol></blockquote><h2 id="映射文件Xxxmapper-xml"><a href="#映射文件Xxxmapper-xml" class="headerlink" title="映射文件Xxxmapper.xml"></a>映射文件Xxxmapper.xml</h2><ol><li>将id回写到user对象<blockquote><p><code>useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot; keyColumn=&quot;id&quot;</code></p></blockquote></li><li>接收参数方式(两种)<blockquote><p>①${}:非预编译,直接拼接,不能防止sql注入,通常用于表名,<br>注意,如果sql语句中只用了一个参数,且接口文件没有使用@param注解,则只能固定使用${value}获取参数的值;</p></blockquote></li></ol><blockquote><p>②#{}:预编译,只是表示占位，与参数的名字无关，如果只有一个参数，可以使用#{任意参数名}接收参数值，会自动对应</p></blockquote><p>获取多个参数</p><blockquote><p>${}:接口使用@param注解</p></blockquote><blockquote><p>#{}:默认规则{0,1,param1,param2},即可以#{0} #{1},或者#{param1} #{param2}; 使用#param注解</p></blockquote><blockquote><p>如果在接口文件中使用了@param注释,则如果参数是pojo或者HashMap,则需要#{参数名.属性名}/${参数名.属性名}</p></blockquote><blockquote><p>${}/#{}在使用过程中空格对其的影响, 例如当其为like等的一部分参数,需要在%前后加空格,如’%’ ${} ‘%’,==什么时候加空格?==&gt;&gt;当${}/#{}和其他符号组合成为某个关键字的一个参数时,需要加.(课上说的就是%,具体待验证)</p></blockquote>]]></content:encoded>
      
      <comments>http://curllen.uicp.io/2018/10/31/mybatis%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#disqus_thread</comments>
    </item>
    
    <item>
      <title>IDEA打包类为Jar</title>
      <link>http://curllen.uicp.io/2018/10/16/IDEA%E6%89%93%E5%8C%85%E7%B1%BB%E4%B8%BAJar/</link>
      <guid>http://curllen.uicp.io/2018/10/16/IDEA%E6%89%93%E5%8C%85%E7%B1%BB%E4%B8%BAJar/</guid>
      <pubDate>Tue, 16 Oct 2018 12:54:36 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;&lt;code&gt;有的时候需要把自己写工具打包成jar包,供自己或者他人使用.&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;情况分为两类&quot;&gt;&lt;a href=&quot;#情况分为两类&quot; class=&quot;headerlink&quot; title=&quot;情况分为两类:&quot;&gt;&lt;/a&gt;情况分为两类:&lt;/h1&gt;&lt;blo
        
      
      </description>
      
      <content:encoded><![CDATA[<p><code>有的时候需要把自己写工具打包成jar包,供自己或者他人使用.</code></p><h1 id="情况分为两类"><a href="#情况分为两类" class="headerlink" title="情况分为两类:"></a>情况分为两类:</h1><blockquote><p>1.自己的工具类没有导入(引用)第三方jar包;</p></blockquote><blockquote><p>2.自己的工具类引用了第三方jar包.</p></blockquote><hr><h2 id="第一类的处理"><a href="#第一类的处理" class="headerlink" title="第一类的处理"></a>第一类的处理</h2><ul><li>对于情况1的处理步骤(以下情况适应一次打包多个文件):<ul><li>如图, 例如打包实体类中的Book.java<br><br><img src="/2018/10/16/IDEA打包类为Jar/01.png" alt="image"><br></li><li>打开File -&gt; Project Structure -&gt; Artifacts -&gt; + -&gt; JAR -&gt; Empty<br><br><img src="/2018/10/16/IDEA打包类为Jar/02.png" alt="image"></li><li>在Output Layout中,依次建立文件夹,文件夹名字和结构和Book.java所在的路径保持一致<br><img src="/2018/10/16/IDEA打包类为Jar/03.png" alt="image"><br></li><li>在Output Layout中,点击 + -&gt;file, 添加Book.Class文件<br><img src="/2018/10/16/IDEA打包类为Jar/04.png" alt="image"><br><br><img src="/2018/10/16/IDEA打包类为Jar/05.png" alt="image"></li><li>点击 Apply ,再点击 Create Manifest创建配置文MANIFEST.MF,该文件可以定为工程中任意目录下,完成配置<br><br><img src="/2018/10/16/IDEA打包类为Jar/06.png" alt="image"><br><img src="/2018/10/16/IDEA打包类为Jar/07.png" alt="image"></li><li>回到IDEA，选择Build -&gt; Build Artifacts，成功生成Jar包。生成的Jar包位于上图设置的Output directory</li></ul></li></ul><hr><h2 id="第二类的处理"><a href="#第二类的处理" class="headerlink" title="第二类的处理"></a>第二类的处理</h2><ul><li>对于情况2的处理,可以使用方式1,但是在其他项目中导入自己的jar包后, 也得把自己jar包所依赖的第三方jar包也导入该工程,否者无效,方式1中网上的通过Class-Path设置第三方jar包位置是不可用的,第二种方式如下:<ul><li>如图, 例如打包实体类中的BeanCommonUtils.java,该类依赖第三方jar包commons-beanutils-1.9.3.jar <br></li><li>打开File -&gt; Project Structure -&gt; Artifacts -&gt; + -&gt; JAR -&gt; From modules with dependencies<br><br><img src="/2018/10/16/IDEA打包类为Jar/08.png" alt="image"><br><img src="/2018/10/16/IDEA打包类为Jar/09.png" alt="image"></li><li>上图出现的相关参数说明如下:<ul><li>module是你需要打成jar包的项目</li><li>MainClass是运行的主函数，如果不需要运行则可以不选择</li><li>jar files from libraries是项目打包的方式，下面选项大致的含义：<ol><li>extract to the target jar：把所有文件倒入进一个jar包里</li><li>copy to the。。。。：把项目的依赖包导出和项目一个目录，通过MANIFEST.MF文件来引用jar包。</li></ol></li></ul></li><li>回到IDEA，选择Build -&gt; Build Artifacts，成功生成Jar包。生成的Jar包位于上图设置的Output directory</li></ul></li></ul><blockquote><p>这里如果你的项目需要打成一个可运行的jar包推荐第二种，反之第一种。<br>另,未验证:如果项目中引用的Jar包有签名过，最后打包成的Jar包运行时会抛出错误：<br><code>java.lang.SecurityException: Invalid signature file digest for Manifest main attributes</code></p></blockquote><blockquote><p>From modules with dependencies，==会把在项目中用到的Jar包解压开==，当成项目的一部分，打包到最后的Jar包中，这样就不会出现采用方式1时，通过网上说的使用Class-Path方式设置第三方jar包位置时导致出现的找不到类异常。</p></blockquote><blockquote><p>==该方式只适合于该工程所有类都需要被打包到该jar包中的情况!==</p></blockquote><blockquote><p>==生成的jar中会有该工程lib文件夹下的第三方jar包, 这些jar已不产生作用, 可以删除!==</p></blockquote><p>​    </p>]]></content:encoded>
      
      <comments>http://curllen.uicp.io/2018/10/16/IDEA%E6%89%93%E5%8C%85%E7%B1%BB%E4%B8%BAJar/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
